```java
/**
     * 新增商品调拨
     * 
     * @param allotManagement 商品调拨
     * @return 结果
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public int insertAllotManagement(AllotManagement allotManagement)
    {
        try {
            // 设置主表字段
            allotManagement.setCreatedBy(SecurityUtils.getLoginUser().getUser().getNickName());
            allotManagement.setCreatedAt(new Date());
            allotManagement.setDelFlag("0");
            allotManagement.setDocStatus("0"); // 单据状态
            allotManagement.setOutWarehouseStatus("0"); // 出库状态
            allotManagement.setInWarehouseStatus("0"); // 入库状态

            // 插入主表
            int result = allotManagementMapper.insertAllotManagement(allotManagement);
            if (result <= 0) {
                throw new RuntimeException("主表插入失败");
            }

            // 子表插入
            List<AllotManagementChild> detailList = allotManagement.getAllotDetailList();
            if (detailList == null || detailList.isEmpty()) {
                throw new RuntimeException("子表数据为空");
            }

            for (AllotManagementChild child : detailList) {
                // 校验必填项
                if (child.getOutWarehouseLocation() == null
                        || child.getCommodityNumber() == null
                        || child.getOutNumber() == null) {
                    throw new RuntimeException("子表存在未填写的必要字段");
                }
                // 出库数量不能大于库存数量
                if (child.getOutNumber() > child.getInventoryNumber()) {
                    throw new RuntimeException("出库数量不能大于库存数量");
                }

                // 设置关联字段与默认信息
                child.setAllotId(allotManagement.getAllotId());
                child.setCreatedBy(SecurityUtils.getLoginUser().getUser().getNickName());
                child.setCreatedAt(new Date());
                child.setDelFlag("0");

                int insertChildResult = allotManagementChildMapper.insertAllotManagementChild(child);
                if (insertChildResult <= 0) {
                    throw new RuntimeException("子表插入失败");
                }
            }

            return 1; // 全部成功
        } catch (Exception e) {
            // 出现异常会自动回滚
            throw new RuntimeException("新增商品调拨失败，原因：" + e.getMessage(), e);
        }
    }

    /**
     * 修改商品调拨
     * 
     * @param allotManagement 商品调拨
     * @return 结果
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public int updateAllotManagement(AllotManagement allotManagement)
    {
        try {
            allotManagement.setUpdatedBy(SecurityUtils.getLoginUser().getUser().getNickName());
            allotManagement.setUpdatedAt(new Date());
            // 更新主表
            int updateResult = allotManagementMapper.updateAllotManagement(allotManagement);
            if (updateResult <= 0) {
                throw new RuntimeException("主表更新失败");
            }

            // 子表更新
            List<AllotManagementChild> detailList = allotManagement.getAllotDetailList();
            if (detailList == null || detailList.isEmpty()) {
                throw new RuntimeException("子表数据为空");
            }

            for (AllotManagementChild child : detailList) {
                // 校验必填项
                if (child.getOutWarehouseLocation() == null
                        || child.getCommodityNumber() == null
                        || child.getOutNumber() == null) {
                    throw new RuntimeException("子表存在未填写的必要字段");
                }
                // 出库数量不能大于库存数量
                if (child.getOutNumber() > child.getInventoryNumber()) {
                    throw new RuntimeException("出库数量不能大于库存数量");
                }
                // 设置关联字段与默认信息
                child.setUpdatedBy(SecurityUtils.getLoginUser().getUser().getNickName());
                child.setUpdatedAt(new Date());

                int updateChildResult = allotManagementChildMapper.updateAllotManagementChild(child);
                if (updateChildResult <= 0) {
                    throw new RuntimeException("子表更新失败");
                }

            }
            return 1;
        } catch (Exception e) {
        // 出现异常会自动回滚
        throw new RuntimeException("更新商品调拨失败，原因：" + e.getMessage(), e);
    }

```

