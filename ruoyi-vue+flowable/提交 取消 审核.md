```vue
<el-row :gutter="10" class="mb8">
      <el-col :span="1.5">
        <el-button type="primary" plain icon="el-icon-plus" size="mini" @click="handleAdd"
          v-hasPermi="['refund:refund:add']">新增</el-button>
      </el-col>
      <el-col :span="1.5">
        <el-button type="success" plain icon="el-icon-edit" size="mini" :disabled="single || !isUnsubmitted"
          @click="handleUpdate" v-hasPermi="['refund:refund:edit']">修改</el-button>
      </el-col>
      <el-col :span="1.5">
        <el-button type="danger" plain icon="el-icon-delete" size="mini" :disabled="multiple || disableDelete"
          @click="handleDelete" v-hasPermi="['refund:refund:remove']">删除</el-button>
      </el-col>
      <el-col :span="1.5">
        <el-button type="warning" plain icon="el-icon-download" size="mini" @click="handleExport"
          v-hasPermi="['refund:refund:export']">导出</el-button>
      </el-col>
      <el-col :span="1.5">
        <el-button type="primary" plain icon="el-icon-upload" size="mini" :disabled="single || !isUnsubmitted"
          @click="handleSubmit" v-hasPermi="['refund:refund:submit']">提交</el-button>
      </el-col>
      <el-col :span="1.5">
        <el-button type="danger" plain icon="el-icon-close" size="mini" :disabled="single || !isUnsubmitted"
          @click="handleCancel" v-hasPermi="['refund:refund:cancel']">取消</el-button>
      </el-col>
      <el-col :span="1.5">
        <el-button type="primary" plain icon="el-icon-close" size="mini" @click="handleApproval"
          v-hasPermi="['refund:refund:approval']">审核</el-button>
      </el-col>
      <right-toolbar :showSearch.sync="showSearch" @queryTable="getList"></right-toolbar>
    </el-row>
```

```vue
<el-table-column label="操作" align="center" class-name="small-padding fixed-width">
        <template slot-scope="scope">
          <el-button v-if="scope.row.docStatus == '0'" size="mini" type="text" icon="el-icon-edit" @click="handleUpdate(scope.row)"
            v-hasPermi="['allot:allot:edit']">修改</el-button>
          <el-button v-if="scope.row.docStatus == '0'" size="mini" type="text" icon="el-icon-delete" @click="handleDelete(scope.row)"
            v-hasPermi="['allot:allot:remove']">删除</el-button>
        </template>
      </el-table-column>
```

```vue
<!-------------------------------------------- 填写审核申请单弹窗 ----------------------------------------------------->
    <el-dialog title="审核申请单" :visible.sync="approvalDialogVisible" width="480px" @close="resetApprovalForm">
      <el-form :model="approvalForm" ref="approvalForm" label-width="100px">
        <el-form-item label="审核结果" prop="approvalStatus" :rules="[{ required: true, message: '请选择审核结果' }]">
          <el-radio-group v-model="approvalForm.approvalStatus">
            <el-radio label="2">通过</el-radio>
            <el-radio label="1">驳回</el-radio>
          </el-radio-group>
        </el-form-item>

        <el-form-item label="审核说明" prop="approvalExplaination" :rules="[{ required: true, message: '请填写审核说明' }]">
          <el-input type="textarea" v-model="approvalForm.approvalExplaination" rows="4" placeholder="填写审核说明" />
        </el-form-item>
      </el-form>

      <span slot="footer" class="dialog-footer">
        <el-button @click="approvalDialogVisible = false">取消</el-button>
        <el-button type="primary" @click="submitApproval">提交审核</el-button>
      </span>
    </el-dialog>

    <!-------------------------------------------- 查看审核记录弹窗 ----------------------------------------------------->
    <el-dialog title="审核记录" :visible.sync="approvalRecordDialogVisible" width="600px">
      <el-table :data="approvalRecordList" border stripe>
        <el-table-column label="审核状态" prop="approvalStatus" width="100" align="center">
          <template slot-scope="scope">
            <el-tag :type="scope.row.approvalStatus === '2' ? 'success' : 'danger'">
              {{ scope.row.approvalStatus === '2' ? '通过' : '驳回' }}
            </el-tag>
          </template>
        </el-table-column>

        <el-table-column label="审核说明" prop="approvalExplaination" align="center" />

        <el-table-column label="审核人" prop="approvedBy" width="120" align="center" />

        <el-table-column label="审核时间" prop="approvedAt" width="160" align="center">
          <template slot-scope="scope">
            {{ parseTime(scope.row.approvedAt, '{y}-{m}-{d} {h}:{i}:{s}') }}
          </template>
        </el-table-column>
      </el-table>

      <span slot="footer" class="dialog-footer">
        <el-button @click="approvalRecordDialogVisible = false">关闭</el-button>
      </span>
    </el-dialog>
```



```js
data() {
    return {
      odds: [], // 存放单号  
      selectedRow: null, // 当前选中的单据
      disableDelete: false, // 是否禁用删除按钮
      approvalRecordDialogVisible: false,
      approvalRecordList: [], // 审核记录数据
      approvalDialogVisible: false,
      approvalForm: {
        approvalStatus: '',           // 审核结果 '2'通过，'1'驳回
        approvalExplaination: '',     // 审核说明
      },
      
```

```js
computed: {
    isUnsubmitted() {
      const flag = this.selectedRow && this.selectedRow.docStatus === '0';
      return flag;
    },
  },
```

```js
// 多选框选中数据
    handleSelectionChange(selection) {
      this.ids = selection.map(item => item.allotId)
      this.single = selection.length !== 1
      this.multiple = !selection.length
      this.odds = selection.map(item => item.allotNumber) // 选中的单号数组
      this.selectedRow = selection.length === 1 ? selection[0] : null;
      // 判断是否存在 orderStatus 不为 0 的记录
      this.disableDelete = selection.some(item => item.docStatus !== '0');
    },
```

```js
// 提交按钮逻辑
    async handleSubmit() {
      this.$confirm("确定要提交单号为 " + this.odds[0] + " 的 单据吗？提交后将不可修改。", "提示", {
        type: "warning"
      }).then(async () => {
        // 调接口更新状态为已提交
        await updateSubmitStatus('1', this.selectedRow.allotId);

        this.$message.success("单据已提交");

        // 提交之后，需要把审核状态改为待审核
        await updateApprovalStatus('0', this.selectedRow.allotId);
        this.getList(); // 刷新列表
      }).catch(() => {
        this.$message.error("提交失败，请稍后再试");
      });
    },
        // 取消按钮逻辑
    handleCancel() {
      this.$confirm("确定要取消该单据吗？取消后将不可编辑。", "提示", {
        type: "warning"
      }).then(() => {
        updateSubmitStatus('2', this.selectedRow.allotId).then(() => {
          this.$message.success("单据已取消");
          this.getList();
        });

      }).catch(() => { });
    },
```

```js
// 更新提交状态
export function updateSubmitStatus(submitStatus, returnId) {
  return request({
    url: `/refund/refund/updateSubmitStatus?submitStatus=${submitStatus}&returnId=${returnId}`,
    method: 'put'
  })
}

// 更新审核状态
export function updateApprovalStatus(approvalStatus, returnId) {
  return request({
    url: `/refund/refund/updateApprovalStatus?approvalStatus=${approvalStatus}&returnId=${returnId}`,
    method: 'put'
  })
}
```

```js
// 点击审核按钮触发
    handleApproval() {
      if (!this.selectedRow) {
        this.$message.warning("请选择一个单据！");
        return;
      }
      if (this.selectedRow.docStatus !== '1' || this.selectedRow.outWarehouseStatus === '2') { // 假设 '1'是已提交状态
        this.$message.warning("只有已提交且未审核通过的单据才能审核！");
        return;
      }
      this.approvalDialogVisible = true;
    },
    // 重置审核表单
    resetApprovalForm() {
      this.$refs.approvalForm.resetFields();
      this.approvalForm = {
        approvalStatus: '',
        approvalExplaination: '',
      };
    },
    // 提交审核
    submitApproval() {
      this.$refs.approvalForm.validate((valid) => {
        if (!valid) return;

        // 组装请求数据
        const payload = {
          allotId: this.selectedRow.allotId,
          approvalStatus: this.approvalForm.approvalStatus,
          approvalExplaination: this.approvalForm.approvalExplaination,
        };

        // 调用后端接口，保存审核记录，并更新申请单状态
        saveApprovalRecord(payload).then(() => {
          // 如果驳回（1），状态改回未提交（0），如果通过（2），无需更新）
          if (payload.approvalStatus === '1') {
            const newStatus = '0'; // 驳回时改为未提交状态
            return updateSubmitStatus(payload.returnId, newStatus);
          }

        }).then(() => {
          this.$message.success("审核已提交");
          this.approvalDialogVisible = false;
          this.getList();  // 刷新列表
        }).catch(() => {
          this.$message.error("审核提交失败");
        });
      });
    },
```

```java
// 保存审核记录
    @PutMapping("/saveApprovalRecord")
    public int saveApprovalRecord(@RequestBody AllotManagementApprovalRecord allotManagementApprovalRecord){
        //更新主表的审核状态
        String approvalStatus = allotManagementApprovalRecord.getApprovalStatus();
        allotManagementService.updateApprovalStatus(approvalStatus, allotManagementApprovalRecord.getAllotId());
        //插入记录表
        return allotManagementApprovalRecordService.insertAllotManagementApprovalRecord(allotManagementApprovalRecord);
    }
```

