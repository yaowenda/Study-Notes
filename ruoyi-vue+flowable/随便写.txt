delete from act_ru_actinst where PROC_INST_ID_ = '752597';
delete from act_ru_task where PROC_INST_ID_ = '752597';
delete from act_ru_identitylink where PROC_INST_ID_ = '752597';
delete from act_ru_variable where PROC_INST_ID_ = '752597';
delete from act_ru_execution where PROC_INST_ID_ = '752597';





```vue
<el-descriptions-item label="离职单扫描">
              <button v-if="isValidFilePath(form.peoResignationTicket)" type="text"
                @click="handleFileView(form.peoResignationTicket)">
                <i class="el-icon-document"></i> 查看
              </button>
              <span v-else>{{ form.peoResignationTicket || '暂无' }}</span>
            </el-descriptions-item>
```

```vue
<el-form-item label="订单状态" prop="orderStatus">
          <el-select v-model="form.orderStatus" placeholder="请选择订单状态">
            <el-option
              v-for="dict in dict.type.order_status"
              :key="dict.value"
              :label="dict.label"
              :value="dict.value"
            ></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="审批状态" prop="approvalStatus">
          <el-select v-model="form.approvalStatus" placeholder="请选择审批状态">
            <el-option
              v-for="dict in dict.type.approval_status"
              :key="dict.value"
              :label="dict.label"
              :value="dict.value"
            ></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="付款状态" prop="paymentStatus">
          <el-select v-model="form.paymentStatus" placeholder="请选择付款状态">
            <el-option
              v-for="dict in dict.type.payment_status"
              :key="dict.value"
              :label="dict.label"
              :value="dict.value"
            ></el-option>
          </el-select>
        </el-form-item>
```





```java
<el-table-column label="生产厂家" prop="clientName" width="100px" />
        <el-table-column label="品牌" prop="commodityBrand" width="130px" />
        <el-table-column label="型号" prop="commodityModel" width="130px" />
        <el-table-column label="规格" prop="commoditySpecification" width="400px" />
```



```java
/**
     * 修改子元素关系
     * 
     * @param deptId 被修改的部门ID
     * @param newAncestors 新的父ID集合
     * @param oldAncestors 旧的父ID集合
     */
    public void updateDeptChildren(Long deptId, String newAncestors, String oldAncestors)
    {
        List<SysDept> children = deptMapper.selectChildrenDeptById(deptId);
        for (SysDept child : children)
        {
            child.setAncestors(child.getAncestors().replaceFirst(oldAncestors, newAncestors));
        }
        if (children.size() > 0)
        {
            deptMapper.updateDeptChildren(children);
        }
    }
```

```sql
<if test="deptId != null and deptId != 0">
			AND (u.dept_id = #{deptId} OR u.dept_id IN ( SELECT t.dept_id FROM sys_dept t WHERE find_in_set(#{deptId}, ancestors) ))
		</if>
```





```java
@Transactional(rollbackFor = Exception.class)
    @Override
    public int insertPurchaseReturn(PurchaseReturn purchaseReturn)
    {
        purchaseReturn.setCreatedBy(SecurityUtils.getLoginUser().getUser().getNickName());
        purchaseReturn.setCreatedAt(new Date());
        purchaseReturn.setDelFlag("0");
        purchaseReturn.setSubmitStatus("0"); //设置为未提交
        purchaseReturn.setApprovalStatus("0"); // 设置为待审核

        // 校验所有子项，确保全部通过
        if(purchaseReturn.getPurchaseReturnChildList() != null){
            for(PurchaseReturnChild child : purchaseReturn.getPurchaseReturnChildList()){
                // 已提交的退货数量
                Map<String, Object> params = new HashMap<>();
                params.put("commodityNumber", child.getCommodityNumber());
                params.put("commodityUnit", child.getCommodityUnit());
                params.put("orderId", child.getOrderId());
                Long haveReturnedQuantity = purchaseReturnChildMapper.getHaveReturnedQuantity(params);
                // 检查退货数量是否超过可退货数量
                if(
                        (child.getBackQuantity() != null ? child.getBackQuantity() : 0L ) +
                        (haveReturnedQuantity != null ? haveReturnedQuantity : 0L) >
                        child.getQuantity()
                ){
                    return -1; // 退货数量超过可退货数量
                }
            }

        }
        // 通过校验之后先插入主表
        int result = purchaseReturnMapper.insertPurchaseReturn(purchaseReturn);
        if (result == 0) {
            throw new RuntimeException("插入采购退货主表失败");
        }
        // 插入子表
        if (purchaseReturn.getPurchaseReturnChildList() != null
                && !purchaseReturn.getPurchaseReturnChildList().isEmpty()) {
            for (PurchaseReturnChild child : purchaseReturn.getPurchaseReturnChildList()) {
                child.setReturnId(purchaseReturn.getReturnId());
                child.setOrderId(child.getOrderId());
                purchaseReturnChildMapper.insertPurchaseReturnChild(child); // 子表插入
            }

        }
        return 1;
    }
```

```vue
<!-- 调拨明细表 -->
        <el-table :data="viewForm.allotDetailList" size="small" border style="margin-top:10px">
          <el-table-column label="库位" prop="storageLocationName" />
          <el-table-column label="商品代码" prop="commodityNumber" />
          <el-table-column label="商品名称" prop="commodityName" />
          <el-table-column label="厂家" prop="clientName" />
          <el-table-column label="品牌" prop="commodityBrand" />
          <el-table-column label="型号" prop="commodityModel" />
          <el-table-column label="规格" prop="commoditySpecification" />
          <el-table-column label="库存数量" prop="inventoryNumber" />
          <el-table-column label="出库数量" prop="outNumber" />
        </el-table>
      </el-form>
```

