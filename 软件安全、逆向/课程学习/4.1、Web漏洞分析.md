## 概述

<img src="assets/image-20250616185909646.png" alt="image-20250616185909646" style="zoom:67%;" />

[OWASP TOP 10 简介](https://firmianay.gitbooks.io/ctf-all-in-one/content/doc/1.4.5_owasp_basic.html)

**不安全的直接对象引用：**

​	应用程序没有检查用户是否具备访问权限而让其能够直接调用系统的资源(如文件、数据库记录)，或者是修改URL 表单的参数。

举例：

​	新闻检索：http://example.com/online/getnews.asp?item=20July2017.html

​	攻击者：http://example.com/online/getnews.asp?item=././winnt/win.ini

​	防范：

​		1、避免在URL中直接引用内部文件名或者数据库关键字。

​		2、根据最小权限原则，禁止访问Web目录之外的文件

​		3、任何来自不可信源的直接对象引用都必须通过访问控制检测，确保该用户对请求的对象有访问权限。

​		4、验证用户输入和URL请求，拒绝包含./(当前目录)或../（父级目录）或者是转码的类“.%2f..%2f”请求。(%2f表示特殊字符/的编码形式)

**缺失功能级访问控制：**

​	是指大部分Web 应用都会在客户端检查访问权限，但是在服务器端没有执行相应的访问控制。

​	举例：很多系统的权限控制是通过页面灰化或隐藏URL实现的，没有在服务器端进行身份确认和权限验证，导致攻击者通过修改页面样式或获取隐藏URL，进而获取特权页面来对系统进行攻击，或者攻击者伪造请求访问未经授权的功能。

​	防范：

​		1、设计严格的权限控制系统，对于每个请求和URL都要进行校验和权限确认

​		2、对于每个功能的访问，都要有明确的角色授权，采用过滤器的方式校验每个请求的合法性

**XML外部实体注入（XXE）**

XXE（XML External Entity）漏洞是一种安全漏洞，出现在使用XML解析器的应用程序中。它允许攻击者利用可信任的XML扩展功能来执行恶意操作，如读取本地文件、发起远程网络请求或执行任意命令。      

攻击者可以通过构造恶意的XML输入，将外部实体（external entity）引用进来，然后利用这些实体来获取敏感信息或进行其他攻击。其中最常见的一种攻击是利用DTD来读取本地文件，DTD 全称是 `The document type definition`，即是**文档类型定义**，当应用接收并解析‌未经验证的XML输入‌时，若DTD（文档类型定义）允许引用外部实体，攻击者可构造包含恶意实体的XML载荷‌，解析器执行实体替换时，将加载攻击者指定的外部资源（如本地文件、远程URL）‌。

```xml
POST /AjaxSearch.ashx HTTP/1.1
Host: test.com
Content-Type: text/xml;

<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<c>&xxe</c>
```

我们创建了一个外部引用文档类型定义去访问一个敏感的系统文件，而这个外部引用会在应用程序中替代已经命名的实体去执行，最终获取到敏感文件，如果这个时候的执行结果会返回给用户，那么用户就可以看到敏感文件中的内容。



解析器尝试访问内网地址，攻击者可探测内网端口或服务

```
<!DOCTYPE root [
	<!ENTITY ssrf SYSTEM "http://192.168.1.1:8080/internal">
]>
<data>&ssrf;</data>
```



## SQL注入漏洞

[预编译SQL为什么能够防止SQL注入](https://www.cnblogs.com/Createsequence/p/16963891.html)

## XSS

### 反射型XSS

典型攻击过程描述：

1）攻击者精心构造恶意URL，通过email发送给受害者

2）受害者单击该URL，用户浏览器向服务器发送包含恶意脚本的请求



```php
<?php
// Is there any input?
if(array_key_exists("name",$_GET)&&$_GET['name']!=''){
    // Feedback for end user
    echo '<pre>Hello '.$_GET['name'].'</pre>';
}
?>
```

在PHP中，所有通过GET请求传入的参数都会被解析成一个关联数组`$_GET`

URL：`?name=Tom&age=25`

PHP解析成：

```php
$_GET = [
    'name' => 'Tom',
    'age' => '25'
];
```

URL：`?name=John%20Doe&city=New+York`

PHP解析成：

```php
$_GET = [
    'name' => 'John Doe',
    'city' => 'New York'
];
```

URL：`?colors[]=red&colors[]=green&colors[]=blue`

PHP解析成：

```php
$_GET = [
    'colors' => ['red', 'green', 'blue']
];
```

URL：`?user=Tom&user=Jerry`

PHP解析成

```php
$_GET = [
    'user' => 'Jerry'
];
```

所以XSS漏洞：

```
?name=<script>alert("hello")</script>
?name=<script>alert(document.cookie)</script>
```

